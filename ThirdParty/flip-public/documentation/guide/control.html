<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Flip Basics Programming Guide: Controlling the Model</title>
<style>
* {font-family: 'Lucida Grande', Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
body {background-color: #fff; }
p {color: black; font-size: 13px; margin-bottom: 10px;}
h1 {color: black; font-size: 28px; margin-bottom: 32px; padding-top: 24px; font-weight: normal; display: block; }
h2 {color: #3c4c6c; display: block; font-size: 24px; font-weight: normal; margin-bottom: 20px; margin-top: 42px; border-bottom-color: #8391a8; border-bottom-style: solid; border-bottom-width: 1px;}
h3 {color: black; font-size: 19px; margin-bottom: 4px; margin-top: 28px; font-weight: normal; display: block; }
a {color: #36c; text-decoration: none; cursor:pointer; }
a:active {color: #36c; text-decoration: none; cursor:pointer; }
a:hover {color: #36c; text-decoration: underline; cursor:pointer; }
.aerr {color: #f00}
h2 a {color: #3c4c6c; text-decoration: none; cursor:auto; }
h2 a:active {color: #3c4c6c; text-decoration: none; cursor:auto; }
h2 a:hover {color: #3c4c6c; text-decoration: none; cursor:auto; }
h3 a {color: black; text-decoration: none; cursor:auto; }
h3 a:active {color: black; text-decoration: none; cursor:auto; }
h3 a:hover {color: black; text-decoration: none; cursor:auto; }
footer {font-size: 10px; position: fixed; display: block; bottom: 0px; background-color: #f1f5f9; border-top-color: #c7cfd5; border-top-style: solid; border-top-width: 1px; width: 100%; height:22px; padding-top: 7px; padding-left: 7px;}
div {display: block;}
.codeblock {margin-top:17px; margin-bottom:17px; clear: both; display: block; color: #333; }
pre {font-family: Courier, Consolas, monospace; font-size: 12px; height: 14px; line-height: 14px; margin-bottom: 0px; margin-left: 6px; margin-right: 4px; margin-top: -1px;}
small pre {color:#888;}
emph pre {color:#000;}
table {padding-top:5px; padding-bottom:6px; margin-bottom:12px; background-color: #f1f5f9; border-color: #c7cfd5; border-style: solid; border-width: 1px; width: 100%;}
tr {}
td > p {margin-left: 6px; height: 12px;}
.note {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #fff; border-color: #5088c5; border-style: solid; border-width: 1px; display: block;}
.note strong {margin-right: 8px;}
.note p {margin-top: 7px;}
.important {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #f1f5f9; border-color: #5088c5; border-style: solid; border-width: 1px; display: block;}
.important strong {margin-right: 8px;}
.important p {margin-top: 7px;}
.warning {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #f8e3e1; border-color: #c5443e; border-style: solid; border-width: 1px; display: block;}
.warning strong {margin-right: 8px;}
.warning p {margin-top: 7px;}
.caption p {color: black; font-size: 10px; margin-bottom: 10px;}
img {margin-top:10px; margin-bottom:10px;}
ul {margin-left: 17px; margin-bottom: 10px;}
ol {margin-left: 17px; margin-bottom: 10px;}
li {color: black; font-size: 13px; margin-bottom: 7px;}
code {font-family: Courier, Consolas, monospace;}
#content {padding-left: 26px; padding-right: 26px; position: absolute; top: 30px; left: 230px; width: 750px;}
#toc {width: 230px; position: fixed; top: 30px; background-color: #f1f5f9; height: 100%; border-right-color: #c7cfd5; border-right-style: solid; border-right-width: 1px; padding-left: 0px; padding-top: 17px; overflow: auto;}
#toc > ul {list-style-type: none;}
#toc > ul > li {font-size: 11px; }
#toc > ul > li > ul {list-style-type: none; margin-top:8px;}
#toc > ul > li > ul > li {font-size: 11px; }
#toc > p {font-size: 13px; margin-left: 17px;}
.codeblock > p {margin-bottom: 3px; font-size: 11px;}
.codeblock > p > strong {margin-right: 10px; color: #222;}
.nav {font-size: 10px; margin-top: 20px; }
.nav > span {margin-right: 20px;}
.bottomspacer {height:100px;}
#header {width:100%; position: fixed; background-color: #111; height: 30px; z-index: 900;}
#header > p {color:#fff; font-size: 13px; padding-top: 6px; padding-left: 17px; }
#header > p > a {color:#fff; font-size: 13px; text-decoration: none; cursor:pointer; padding-right: 56px;}
.sectioncode {background-color: #f6f6f6; padding: 12px; margin-top: 18px;}
.sectioncode > h3 {margin-top: 0px; padding-bottom: 8px;}
hr { display: block; height: 1px; border: 0; border-top: 1px solid #eee; margin: 28px 0; padding: 0; }</style>
</head>

<body>

<div id="header">
<div style="width: 1006px;"></div>
<p><a href="../index.html">Flip Documentation Library</a><a href="../guide/index.html">Flip Basics Programming Guide</a></p>
</div>
<div id="toc">
<p>Flip Basics Programming Guide</p>
<ul>
<li><a href="../guide/about.html">About Flip Programming Guide</a></li>
<li><a href="../guide/declare.html">Declaring the Model</a></li>
<li><a href="../guide/organize.html">Organizing your Code</a></li>
<li><a href="../guide/control.html">Controlling the Model</a>	<ul>
	<li><a href="../guide/control.html#document">The Document</a></li>
	<li><a href="../guide/control.html#how">How it Works</a></li>
	<li><a href="../guide/control.html#property">Modifying a Property</a></li>
	<li><a href="../guide/control.html#array">Working with Arrays</a></li>
	<li><a href="../guide/control.html#collection">Working with Collections</a></li>
	<li><a href="../guide/control.html#variant">Working with Variants</a></li>
	<li><a href="../guide/control.html#optional">Working with Optionals</a></li>
	</ul>
</li>
<li><a href="../guide/observe.html">Observing the Model</a></li>
<li><a href="../guide/signal.html">Signalling the Model</a></li>
<li><a href="../guide/remote.html">Working with a Remote Server</a></li>
<li><a href="../guide/misc.html">More Fun with Flip</a></li>
<li><a href="../guide/conversion.html">Model Versioning</a></li>
</ul>
</div>

<div id="content">
<div class="nav" align="right">
<a href="organize.html">previous</a><span>&nbsp;</span><a href="observe.html">next</a></div>

<h1>Controlling the Model</h1>

<p>Now that we can declare a model and we know how to organize it, this chapter describes how to manipulate it.</p>

<p>This chapter will use the model declared in the chapter <a href="../guide/declare.html">Declaring the Model</a>.</p>

<h2><a name="document">The Document</a></h2>

<p>To manipulate the model, one must have an instance of the model which is called a <em>document</em>.</p>

<p>A <code>Document</code> is therefore described by the model it uses, a unique user 64-bit identifier, a manufacturer/product identifier as well as a component identifier. The latters only allows to know who is the originator of a modification and allows for concurrent modification of a document.</p>

<div class="codeblock"><table>
<tr><td><pre>#include &quot;flip/DataModel.h&quot;</pre></td></tr>
<tr><td><pre>#include &quot;flip/Document.h&quot;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Model : public flip::DataModel &lt;Model&gt; {};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>...code skipped...</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>void  run ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   declare ();                                                       (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Document document (Model::use (), 123456789ULL, &apos;acme&apos;, &apos;gui &apos;);  (2)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>You must first declare your model before you use it</li>
<li>This line will create a <code>Document</code> which uses <code>Model</code>, <code>123456789ULL</code> user unique identifier, <code>'acme'</code> manufacturer/product for the <code>'gui '</code> component</li>
</ol>

<h2><a name="how">How it Works</a></h2>

<p>When you change the document, Flip will know that it was modified. Transactions represent the difference between two document states. When the document is modified, Flip internally keeps the old and new state of the document.</p>

<p>When you have done the necessary changes that represent a logical modification of the document, you can then <code>commit</code> the document to apply those changes.</p>

<p>In that sense, a transaction (or modification of the document) is always made so that the new document is valid from the model point of view.</p>

<h2><a name="property">Modifying a Property</a></h2>

<p>For this example, let's suppose that we want to change the tempo.</p>

<div class="codeblock"><table>
<tr><td><pre>#include &quot;flip/DataModel.h&quot;</pre></td></tr>
<tr><td><pre>#include &quot;flip/Document.h&quot;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Model : public flip::DataModel &lt;Model&gt; {};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>...code skipped...</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>void  run ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Document document (Model::use (), 123456789ULL, &apos;acme&apos;, &apos;gui &apos;);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Song &amp; song = document.root &lt;Song&gt; ();                            (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   song.tempo = 120.0;                                               (2)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   document.commit ();                                               (3)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>This extract the unique <code>Song</code>, the root of the document.</li>
<li>This sets the tempo of the song to 120 beats per minutes, now the document is marked as modified.</li>
<li>This will apply the change to the document.</li>
</ol>

<p>Commiting a document marks the boundary of the document change, which is computed into a transaction.</p>

<h2><a name="array">Working with <code>Array</code>s</a></h2>

<p>For this example, let's suppose that we want to insert a new track into the song. We suppose here that the document is already set up.</p>

<div class="codeblock"><table>
<tr><td><pre>class Song : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Track &amp;        add_track ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Float    tempo;</pre></td></tr>
<tr><td><pre>   flip::Array &lt;Track&gt;</pre></td></tr>
<tr><td><pre>                  tracks;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>Track &amp;  Song::add_track ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   auto it = tracks.emplace (tracks.end ());    (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   return *it;                                  (2)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Emplace a new track constructed in-place before the <code>end ()</code> <code>iterator</code>. This is similar to push a new element at the back of the <code>Array</code></li>
<li>Dereference the returned <code>iterator</code></li>
</ol>

<div class="note"><p><strong>Note:</strong> One should note that in the above example, the modification is not commited to the document.</p></div>

<h2><a name="collection">Working with <code>Collection</code>s</a></h2>

<p>For this example, let's suppose that we want to insert a new clip into the track.</p>

<div class="codeblock"><table>
<tr><td><pre>class Clip : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>                  Clip () = default;</pre></td></tr>
<tr><td><pre>                  Clip (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Float    position;</pre></td></tr>
<tr><td><pre>   flip::Float    duration;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Track : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Clip &amp;         add_clip (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Collection &lt;Clip&gt;</pre></td></tr>
<tr><td><pre>                  clips;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>Clip &amp;   Track::add_clip (double position, double duration)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   auto it = clips.emplace (clips.end (), position, duration);    (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   return *it;</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Emplace a new clip constructed in-place with the second constructor of <code>Clip</code></li>
<li>Dereference the returned <code>iterator</code></li>
</ol>

<div class="note"><p><strong>Note:</strong> One should note that in the above example, the modification is not commited to the document.</p></div>

<h2><a name="variant">Working with <code>Variant</code>s</a></h2>

<p>For this example, let's suppose that the clip has some content which can be either audio or midi content. Let also suppose that no content is not permitted.</p>

<p>To do that, you would typically use a <code>Variant</code>.</p>

<div class="codeblock"><table>
<tr><td><pre>class Content : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class ContentAudio : public Content</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::String   url;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class ContentMidi : public Content</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Blob     midi_events;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Clip : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>                  Clip () = default;</pre></td></tr>
<tr><td><pre>                  Clip (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Float    position;</pre></td></tr>
<tr><td><pre>   flip::Float    duration;</pre></td></tr>
<tr><td><pre>   Variant &lt;Content&gt;</pre></td></tr>
<tr><td><pre>                  content;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Track : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Clip &amp;         add_clip_audio (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Collection &lt;Clip&gt;</pre></td></tr>
<tr><td><pre>                  clips;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>Clip &amp;   Track::add_clip_audio (double position, double duration, std::string url)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   auto it = clips.emplace (clips.end (), position, duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   auto &amp; clip = *it;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   clip.content.reset &lt;ContentAudio&gt; ().url = url;    (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   return clip;</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Set the content of the clip to be an audio content with its url</li>
</ol>

<div class="note"><p><strong>Note:</strong> One should note that in the above example, failure to provide an initial value to the variant at commit time will trigger a flip validation failure.</p></div>

<h2><a name="optional">Working with <code>Optional</code>s</a></h2>

<p>For this example, let's suppose that the clip has some content which can be either audio or midi content. Let also suppose that no content is allowed this time.</p>

<p>To do that, you would typically use a <code>Optional</code>.</p>

<div class="codeblock"><table>
<tr><td><pre>class Content : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class ContentAudio : public Content</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::String   url;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class ContentMidi : public Content</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Blob     midi_events;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Clip : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>                  Clip () = default;</pre></td></tr>
<tr><td><pre>                  Clip (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Float    position;</pre></td></tr>
<tr><td><pre>   flip::Float    duration;</pre></td></tr>
<tr><td><pre>   Optional &lt;Content&gt;</pre></td></tr>
<tr><td><pre>                  content;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>class Track : public flip::Object</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   static void    declare ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Clip &amp;         add_clip_audio (double position, double duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   flip::Collection &lt;Clip&gt;</pre></td></tr>
<tr><td><pre>                  clips;</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>Clip &amp;   Track::add_clip_audio (double position, double duration, std::string url)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   auto it = clips.emplace (clips.end (), position, duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   auto &amp; clip = *it;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   clip.content.reset &lt;ContentAudio&gt; ().url = url;                      (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   return clip;</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>Clip &amp;   Track::add_clip_no_content (double position, double duration)  (2)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   auto it = clips.emplace (clips.end (), position, duration);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   return *it;</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Set the content of the clip to be an audio content with its url</li>
<li>Set the content of the clip to none</li>
</ol>

<p>Now that we know how to modify the model in different situations, the next part will be about observing those changes with an observer, and is covered in the next chapter <a href="../guide/observe.html">Observing the Model</a>.</p>

<div class="nav" align="right">
<a href="organize.html">previous</a><span>&nbsp;</span><a href="observe.html">next</a></div>

<div class="bottomspacer">&nbsp;</div>
</div>
</body>
</html>
