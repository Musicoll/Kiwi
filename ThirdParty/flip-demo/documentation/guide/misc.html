<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Flip Basics Programming Guide: More Fun with Flip</title>
<style>
* {font-family: 'Lucida Grande', Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
body {background-color: #fff; }
p {color: black; font-size: 13px; margin-bottom: 10px;}
h1 {color: black; font-size: 28px; margin-bottom: 32px; padding-top: 24px; font-weight: normal; display: block; }
h2 {color: #3c4c6c; display: block; font-size: 24px; font-weight: normal; margin-bottom: 20px; margin-top: 42px; border-bottom-color: #8391a8; border-bottom-style: solid; border-bottom-width: 1px;}
h3 {color: black; font-size: 19px; margin-bottom: 4px; margin-top: 28px; font-weight: normal; display: block; }
a {color: #36c; text-decoration: none; cursor:pointer; }
a:active {color: #36c; text-decoration: none; cursor:pointer; }
a:hover {color: #36c; text-decoration: underline; cursor:pointer; }
.aerr {color: #f00}
h2 a {color: #3c4c6c; text-decoration: none; cursor:auto; }
h2 a:active {color: #3c4c6c; text-decoration: none; cursor:auto; }
h2 a:hover {color: #3c4c6c; text-decoration: none; cursor:auto; }
h3 a {color: black; text-decoration: none; cursor:auto; }
h3 a:active {color: black; text-decoration: none; cursor:auto; }
h3 a:hover {color: black; text-decoration: none; cursor:auto; }
footer {font-size: 10px; position: fixed; display: block; bottom: 0px; background-color: #f1f5f9; border-top-color: #c7cfd5; border-top-style: solid; border-top-width: 1px; width: 100%; height:22px; padding-top: 7px; padding-left: 7px;}
div {display: block;}
.codeblock {margin-top:17px; margin-bottom:17px; clear: both; display: block; color: #333; }
pre {font-family: Courier, Consolas, monospace; font-size: 12px; height: 14px; line-height: 14px; margin-bottom: 0px; margin-left: 6px; margin-right: 4px; margin-top: -1px;}
small pre {color:#888;}
emph pre {color:#000;}
table {padding-top:5px; padding-bottom:6px; margin-bottom:12px; background-color: #f1f5f9; border-color: #c7cfd5; border-style: solid; border-width: 1px; width: 100%;}
tr {}
td > p {margin-left: 6px; height: 12px;}
.note {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #fff; border-color: #5088c5; border-style: solid; border-width: 1px; display: block;}
.note strong {margin-right: 8px;}
.note p {margin-top: 7px;}
.important {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #f1f5f9; border-color: #5088c5; border-style: solid; border-width: 1px; display: block;}
.important strong {margin-right: 8px;}
.important p {margin-top: 7px;}
.warning {margin-top:21px; margin-bottom:22px; padding-left: 8px; padding-right: 8px; background-color: #f8e3e1; border-color: #c5443e; border-style: solid; border-width: 1px; display: block;}
.warning strong {margin-right: 8px;}
.warning p {margin-top: 7px;}
.caption p {color: black; font-size: 10px; margin-bottom: 10px;}
img {margin-top:10px; margin-bottom:10px;}
ul {margin-left: 17px; margin-bottom: 10px;}
ol {margin-left: 17px; margin-bottom: 10px;}
li {color: black; font-size: 13px; margin-bottom: 7px;}
code {font-family: Courier, Consolas, monospace;}
#content {padding-left: 26px; padding-right: 26px; position: absolute; top: 30px; left: 230px; width: 750px;}
#toc {width: 230px; position: fixed; top: 30px; background-color: #f1f5f9; height: 100%; border-right-color: #c7cfd5; border-right-style: solid; border-right-width: 1px; padding-left: 0px; padding-top: 17px; overflow: auto;}
#toc > ul {list-style-type: none;}
#toc > ul > li {font-size: 11px; }
#toc > ul > li > ul {list-style-type: none; margin-top:8px;}
#toc > ul > li > ul > li {font-size: 11px; }
#toc > p {font-size: 13px; margin-left: 17px;}
.codeblock > p {margin-bottom: 3px; font-size: 11px;}
.codeblock > p > strong {margin-right: 10px; color: #222;}
.nav {font-size: 10px; margin-top: 20px; }
.nav > span {margin-right: 20px;}
.bottomspacer {height:100px;}
#header {width:100%; position: fixed; background-color: #111; height: 30px; z-index: 900;}
#header > p {color:#fff; font-size: 13px; padding-top: 6px; padding-left: 17px; }
#header > p > a {color:#fff; font-size: 13px; text-decoration: none; cursor:pointer; padding-right: 56px;}
.sectioncode {background-color: #f6f6f6; padding: 12px; margin-top: 18px;}
.sectioncode > h3 {margin-top: 0px; padding-bottom: 8px;}
hr { display: block; height: 1px; border: 0; border-top: 1px solid #eee; margin: 28px 0; padding: 0; }</style>
</head>

<body>

<div id="header">
<div style="width: 1006px;"></div>
<p><a href="../index.html">Flip Documentation Library</a><a href="../guide/index.html">Flip Basics Programming Guide</a></p>
</div>
<div id="toc">
<p>Flip Basics Programming Guide</p>
<ul>
<li><a href="../guide/about.html">About Flip Programming Guide</a></li>
<li><a href="../guide/declare.html">Declaring the Model</a></li>
<li><a href="../guide/organize.html">Organizing your Code</a></li>
<li><a href="../guide/control.html">Controlling the Model</a></li>
<li><a href="../guide/observe.html">Observing the Model</a></li>
<li><a href="../guide/signal.html">Signalling the Model</a></li>
<li><a href="../guide/remote.html">Working with a Remote Server</a></li>
<li><a href="../guide/misc.html">More Fun with Flip</a>	<ul>
	<li><a href="../guide/misc.html#history">Providing Undo/Redo Feature</a></li>
	<li><a href="../guide/misc.html#manipulation">Manipulating Transactions</a></li>
	<li><a href="../guide/misc.html#io">Reading/Writing a Document</a></li>
	</ul>
</li>
<li><a href="../guide/conversion.html">Model Versioning</a></li>
</ul>
</div>

<div id="content">
<div class="nav" align="right">
<a href="remote.html">previous</a><span>&nbsp;</span><a href="conversion.html">next</a></div>

<h1>More Fun with Flip</h1>

<h2><a name="history">Providing Undo/Redo Feature</a></h2>

<p>Flip provides an undo/redo history system.</p>

<div class="codeblock"><table>
<tr><td><pre>void  run ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   Document document (Model::use (), 123456789ULL, &apos;acme&apos;, &apos;gui &apos;);</pre></td></tr>
<tr><td><pre>   History history (document);                                       (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Root &amp; root = document.root &lt;Root&gt; ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   root.happiness_level = 100.0;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   document.set_label (&quot;Change&quot;);                                    (2)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   auto tx = document.commit ();                                     (3)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   history.push (tx);                                                (4)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   history.undo ().execute ();                                       (5)</pre></td></tr>
<tr><td><pre>   history.redo ().execute ();                                       (6)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Set up a history for document</li>
<li>Set a label for the forming transaction</li>
<li><code>commit</code> returns a transaction, which has the label as a metadata</li>
<li>push the transaction to the history system</li>
<li>undo the transaction</li>
<li>redo the transaction</li>
</ol>

<p>The undo/redo/history topic is studied in more details in the book <a href="../history/about.html">Flip History Strategy Guide</a>.</p>

<h2><a name="manipulation">Manipulating Transactions</a></h2>

<p>Transactions represent exactly the difference between to state of the document. Flip flexibility allows to store them, and replay them in any direction.</p>

<div class="codeblock"><table>
<tr><td><pre>void  run ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   Document document (Model::use (), 123456789ULL, &apos;acme&apos;, &apos;gui &apos;);</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   Root &amp; root = document.root &lt;Root&gt; ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   assert (root.tempo == 0.0);            (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   root.tempo = 100.0;</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   auto tx = document.commit ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   document.execute_backward (tx);        (2)</pre></td></tr>
<tr><td><pre>   document.execute_forward (tx);         (3)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>All flip values are constructed with a zero value or an empty state</li>
<li>play the transaction backward, happiness goes back to 0.0. Note that the transaction is applied, but the document is not commited</li>
<li>play the transaction backward, happiness goes back to 100.0. Note that the transaction is applied, but the document is not commited. If it was commited, it would produce an empty transaction.</li>
</ol>

<p>Since transactions can be copied and are just data without external coupling, they can be used for many usual kind of problem solving.</p>

<h2><a name="io">Reading/Writing a Document</a></h2>

<p>Flip supports two formats :</p>

<ul>
<li>A binary format with optimal performance and secure enough for production use,</li>
<li>A markup language format, human readable and editable, for debugging purposes</li>
</ul>

<p>Those two backend formats can be read or written in an infinite number of media using a traditional Consumer/Producer architecture.</p>

<h3><a name="io-write">Writing a Document</a></h3>

<div class="codeblock"><table>
<tr><td><pre>void  write ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   BackEndIR backend = document.write ();       (1)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   std::vector &lt;uint8_t&gt; data;</pre></td></tr>
<tr><td><pre>   DataConsumerMemory consumer (data);          (2)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   backend.write &lt;BackEndBinary&gt; (consumer);    (3)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Write the document into an intermediate representation format. This format is also used to do document revision conversion</li>
<li>Set up a data consumer which will write in memory</li>
<li>Write to the consumer using the binary format</li>
</ol>

<p>See <a href="../reference/BackEndBinary.html">BackEndBinary</a> or <a href="../reference/BackEndMl.html">BackEndMl</a> reference documentation for additional examples.</p>

<h3><a name="io-read">Reading a Document</a></h3>

<div class="codeblock"><table>
<tr><td><pre>void  read ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   std::vector &lt;uint8_t&gt; data;                  (1)</pre></td></tr>
<tr><td><pre>   DataProviderMemory provider (data);          (2)</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   BackEndIR backend;</pre></td></tr>
<tr><td><pre>   backend.register_backend &lt;BackEndBinary&gt; (); (3)</pre></td></tr>
<tr><td><pre>   backend.register_backend &lt;BackEndMl&gt; ();</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>   backend.read (provider);                     (4)</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table></div>

<ol>
<li>Here we suppose that data is already filled with document data</li>
<li>Attach a provider to the data to read</li>
<li>Register the two formats that the backend can read. The backends implementation are able to tell if the incoming data is in the right format</li>
<li>Read the document</li>
</ol>

<p>See <a href="../reference/BackEndBinary.html">BackEndBinary</a> or <a href="../reference/BackEndMl.html">BackEndMl</a> reference documentation for additional examples.</p>

<p>The next chapter, <a href="../guide/conversion.html">Model Versioning</a> will guide you through converting a document from one revision of the model to another one.</p>

<div class="nav" align="right">
<a href="remote.html">previous</a><span>&nbsp;</span><a href="conversion.html">next</a></div>

<div class="bottomspacer">&nbsp;</div>
</div>
</body>
</html>
