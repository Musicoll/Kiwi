language: cpp
dist: trusty
sudo: required

notifications:
  email: false

git:
  submodules: false

install:
    - git submodule update --init --recursive ThirdParty/Juce

matrix:
  include:
  - os: linux
    compiler: g++
    env: COMPILER=g++-4.9
    before_install:
    - sudo apt-get update
    - sudo apt-get install libfreetype6-dev
    - sudo apt-get install libx11-dev
    - sudo apt-get install libxrandr-dev
    - sudo apt-get install libxinerama1
    - sudo apt-get install libxinerama-dev
    - sudo apt-get install libxcursor-dev
    - sudo apt-get install libasound2-dev
    addons:
      apt:
        packages: ['python-pip', 'python-yaml']
    install:
      - git submodule update --init --recursive ThirdParty/Juce
      - pip install --user cpp-coveralls
    script:
    - python ./Config/configure.py -coverage
    - python ./Config/build.py -c Release
    - python ./Config/build.py -c Debug -t Tests
    after_success:
    - openssl aes-256-cbc -K $encrypted_5a43ff9033eb_key -iv $encrypted_5a43ff9033eb_iv -in Config/travisci_rsa.enc -out Config/travisci_rsa -d
    - chmod 0600 Config/travisci_rsa
    - cp Config/travisci_rsa ~/.ssh/id_rsa
    - sudo apt-get install --yes doxygen graphviz
    - ./Config/publish-doxygen.sh
    - coveralls -i Modules --gcov-options '\-lp' > /dev/null

  - os: osx
    compiler: clang++
    env: COMPILER=clang++
    before_install:
      - brew install portaudio
    script:
    - python ./Config/configure.py
    - python ./Config/build.py -c Release
    before_deploy:
    - mkdir Kiwi
    - mv Build/Release/KiwiBuild/Bin/Release/Kiwi.app Kiwi/Kiwi.app
    - zip -r Kiwi_macos.zip Kiwi
    deploy:
      provider: releases
      api_key:
        secure: atcBDMdJNzUGiUYSqQu/URg8mfvRk9b78tvj1eHKCeDXSTP0Y1UvI5YpmTx8SkUXp23QH4sgp0tKTFB98FbRojR4IL2NW+KZDG1o5BxZ4HYJ4hdCXXXhzeujcn2AjQzRJ9f8uodX/7Pfa19jGlovj1Tl9ZJ9jIfyyvcxlJXkTN9+CDlkkcpLNU64c4B+CclS8aLPbIKqvLmIy3fphzzkJoKN5rnE4EvKrIkJBPEib1WIY8K7W8boCwghsGBs04MwRZwidKIjPSPgbYpmGPspfKpu0W8mKMirdGEVt4rzpm+Dl9wMa/5Qsyc6afYfS4p3PZOfBio0mtVrPz4+4VXy/Ad+FDNnvxUy9776D0pSv2iBrdHhqs6n1vG0uT4uhbGtvwJR3BBbo6+TmEKakRgp+uRhYEvGy/EO0OkcKrOVLsrZ/akj8O+KOSROrz2VYfxmDTxtUi8K51vW3pJhcGsEsN1FkcJfef/pvxGLK5i0qEZWoyCyA4YMPNDWFFiuBadPTujIGJ/iDmwouzalV9F0vKOIFvP9IuZ1FHLOyEzhyoBS3l1NNpQUz+HNgupTVYSREH1qPXUHg3B5BdFpEJpOjU/P8gwG4npcNxX/5XvigFFiTeEN+eV4xcBVLcg+SsumeswIqi5Tvm+mzYyqz3wj628ddWxgGiPFSfySI4tz6lg=
      file: Kiwi_macos.zip
      skip_cleanup: true
      on:
        repo: Musicoll/Kiwi
        tags: true
